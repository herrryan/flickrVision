<html>
  <head>
     <title>28msec, Inc - guestbook</title>
     <link type="text/css" href="/css/main.css" rel="stylesheet" /> 
     <link type="text/css" href="/css/28msec-theme/jquery-ui-1.8.2.custom.css" rel="stylesheet" />
     <script type="text/javascript" src="/js/jquery-1.4.4.min.js"></script>
     <script type="text/javascript">
     //<![CDATA[
        function replaceEntries(data){
        	var entries=$("#entries");
            entries.fadeOut("slow",function(){
                $("#wait").remove();
                entries.empty();
                entries.append(data);
	            $(".entry").addClass("ui-widget ui-widget-content ui-corner-all");
                entries.slideDown("slow");
            });
        }
		function timedRefresh(timeoutPeriod) {
			setTimeout(reload, timeoutPeriod);
			// reload();
		}
        // function to refresh entries
        function reload(){
            $.ajax({
                type: "GET",
                url: "guestbook/list",
                timeout: 3600000,
                success: function(data, textStatus) {
                           replaceEntries(data);	
                         },
                error: function(data, textStatus, error) {
                    	   $("#wait").fadeOut("slow", function() {
	                       $("#entries").append('<div style="color:red;">Something bad just happened: ' + textStatus + '; status: ' + data.status + '</div>');
                         });
                       }
            });
        }
        
        $(document).ready(
        	    function(){
        	        //register submit wrapper for the add-form
                    $("#add-form").submit(function(){
                            var form=$("#add-form");
                            var action=form.attr("action");
                            var data=form.serialize();
                            $("#entries").append('<div id="wait" class="entry"><img src="images/loader.gif" alt="loading..." /></div>');
                            $.post(action,data,function(data, textStatus){
                                                if(textStatus=="success"){
                                                    replaceEntries(data);
                                                }else{
                                                    // refresh entries if an error occurred
                                                    reload();
                                                }
                                            }
                            );
                            return false;
	      			    }
                    );
                    // init: styling
                    $("input[type='submit']").addClass("show-summary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only");
                    $("hr").addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");

                    // init: show loading 
                    $("#entries").append('<div id="wait" class="entry"><img src="images/loader.gif" alt="loading..." /></div>');
	      					
                    // init: load entries
                    reload();
	    });
     //]]>
     </script>
  </head>
  <body onload="JavaScript:timedRefresh(60000);">
	  <a href="http://www.28msec.com" target="_blank"><img src="/images/28msecLogo.png" alt="28msec Logo" style="float:right;" /></a> 
	  <br /> 
	  <h1>XQuery Guestbook<span style="vertical-align:sub;font-size:50%;">Beta</span></h1> 
	  <hr style="padding:5px;" /> 
      <br />
    <div>
    	<h2>Entries (last 5 only):</h2>
    	<div id="entries"></div>
    </div>
    <div>
        <h2>Add a new entry:</h2>
        <form id="add-form" action="guestbook/add" method="post">
            <p>Name:<br/><input name="author" type="text" size="30" maxlength="30"/></p>
            <p>Text:<br/><textarea name="text" cols="50" rows="3" onfocus="if(this.value=='Add your text here!'){this.value=''}">Add your text here!</textarea></p>
            <input type="submit" value="Insert" />
        </form>
    </div>
  </body>
</html>
